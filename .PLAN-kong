# Kong Gateway Management in Hub Admin - Implementation Plan

## Overview

Add comprehensive Kong Gateway management features to the WaddleBot hub admin interface, allowing global super admins to manage Kong services, routes, plugins, consumers, upstreams/load balancing, SSL/TLS certificates, and rate limiting directly from the hub instead of using Kong Manager OSS.

## Context

- Kong is now running in database mode with PostgreSQL
- Kong Manager OSS has no authentication (open access)
- Kong Admin API is available at `http://localhost:8001`
- Hub has a Super Admin section for platform-wide management
- Hub uses React 18, Tailwind CSS, Express.js backend

## Goals

1. **Provide Kong management UI** within the hub for super admins
2. **Secure access** to Kong features (super admin only)
3. **Match existing hub UI patterns** (Tailwind, card-based layout)
4. **Cover essential Kong features**: Services, Routes, Plugins, Consumers, Upstreams, Certificates, Rate Limiting
5. **Replace the need** for accessing Kong Manager directly

## Scope

### In Scope
- **Services Management**: View, create, edit, delete Kong services
- **Routes Management**: View, create, edit, delete Kong routes (linked to services)
- **Plugins Management**: View, configure global and route-level plugins
- **Consumers Management**: View, create, delete Kong consumers
- **Upstreams Management**: View, create, edit, delete upstreams and targets for load balancing
- **Certificates Management**: View, upload, delete SSL/TLS certificates and SNIs
- **Rate Limiting Configuration**: Configure and manage rate limiting policies
- **Basic monitoring**: Service health, route status, upstream health

### Out of Scope (Future)
- Advanced plugin configuration (complex forms with validation)
- CA certificates management
- Kong workspace management (Enterprise only)
- Real-time metrics dashboard
- Certificate auto-renewal integration

## Files to Create/Modify

### Backend (4 files)
1. **NEW**: `admin/hub_module/backend/src/utils/kongClient.js`
2. **NEW**: `admin/hub_module/backend/src/controllers/kongController.js`
3. **MODIFY**: `admin/hub_module/backend/src/routes/superadmin.js`
4. **MODIFY**: `.env-example`

### Frontend (11 files)
1. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/SuperAdminKongGateway.jsx`
2. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongServices.jsx`
3. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongRoutes.jsx`
4. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongPlugins.jsx`
5. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongConsumers.jsx`
6. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongUpstreams.jsx`
7. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongCertificates.jsx`
8. **NEW**: `admin/hub_module/frontend/src/pages/superadmin/kong/KongRateLimiting.jsx`
9. **MODIFY**: `admin/hub_module/frontend/src/services/api.js`
10. **MODIFY**: `admin/hub_module/frontend/src/App.jsx`
11. **MODIFY**: `admin/hub_module/frontend/src/layouts/AdminLayout.jsx`

## Implementation Order

### Phase 1: Backend Foundation
- âœ… Create Kong API client utility (kongClient.js)
- âœ… Create Kong controller (kongController.js)
- âœ… Add routes to superadmin.js
- âœ… Update .env-example

### Phase 2: Frontend API
- âœ… Add Kong API methods to services/api.js

### Phase 3: Main UI
- âœ… Create main Kong Gateway page with tabs

### Phase 4-10: Feature Pages
- âœ… Implement Services page
- âœ… Implement Routes page
- âœ… Implement Plugins page
- âœ… Implement Consumers page
- âœ… Implement Upstreams page with targets management
- âœ… Implement Certificates page with SNI management
- âœ… Implement Rate Limiting configuration page

### Phase 11: Navigation Integration
- âœ… Add routing in App.jsx
- âœ… Add navigation link in AdminLayout.jsx

### Phase 12: Testing & Polish
- ğŸ”„ Test all CRUD operations (ready for testing)
- âœ… Error handling (implemented)
- âœ… Loading states (implemented)
- âœ… Responsive design (implemented)

## Success Criteria

1. âœ… Super admins can view all Kong services via hub UI
2. âœ… Super admins can create/edit/delete Kong services
3. âœ… Super admins can view and manage Kong routes
4. âœ… Super admins can view and manage Kong plugins
5. âœ… Super admins can view and manage Kong consumers
6. âœ… Super admins can configure upstreams and load balancing with targets
7. âœ… Super admins can upload and manage SSL/TLS certificates and SNIs
8. âœ… Super admins can configure rate limiting policies at various scopes
9. âœ… UI matches existing hub design patterns (Tailwind, card-based, navy theme)
10. âœ… All operations are properly authenticated (super admin only)
11. âœ… Error messages are user-friendly
12. âœ… Kong Admin API is not exposed externally
13. âœ… No need to access Kong Manager for essential Kong operations
14. âœ… Load balancing algorithms configurable (round-robin, consistent-hashing, etc.)
15. âœ… Certificate expiration warnings displayed
16. âœ… Rate limiting supports multiple time windows (second, minute, hour, etc.)

## Key Features by Tab

### Services (ğŸ”§)
- List all services
- Create service (name, protocol, host, port, path)
- Edit service configuration
- Delete service
- Show enabled/disabled status

### Routes (ğŸ›£ï¸)
- List all routes with service association
- Create route (paths, methods, protocols)
- Edit route configuration
- Delete route
- Link to services

### Plugins (ğŸ”Œ)
- List all plugins with scope (global/service/route)
- Create plugin
- Configure plugin settings
- Enable/disable plugins
- Delete plugins

### Consumers (ğŸ‘¥)
- List consumers
- Create consumer (username, custom_id)
- Delete consumer
- Show credentials count

### Upstreams (âš–ï¸)
- List upstreams with algorithm
- Create upstream (name, algorithm: round-robin, consistent-hashing, least-connections)
- Edit upstream configuration
- Delete upstream
- Manage targets:
  - Add target (host:port, weight)
  - List targets with health status
  - Delete target

### Certificates (ğŸ”’)
- List certificates with expiration dates
- Upload certificate (PEM format: cert + key)
- View certificate details (subject, issuer, expiration)
- Delete certificate
- Manage SNIs:
  - Associate SNI with certificate
  - List SNIs
  - Delete SNI
- Warning indicators for expiring/expired certs

### Rate Limiting (ğŸš¦)
- List rate limiting plugins by scope
- Create rate limiting policy:
  - Policy type: local, cluster, redis
  - Time windows: second, minute, hour, day, month, year
  - Hide client headers option
  - Fault tolerant mode
- Edit rate limiting configuration
- Delete rate limiting plugins
- Show which services/routes have limits

## UI Design

### Color Scheme (matching hub)
- Background: `bg-navy-950`, `bg-navy-900` (cards)
- Text: `text-gray-100` (primary), `text-gray-400` (secondary)
- Accent: `text-sky-400`, `border-sky-500`
- Success: `text-green-400`, `bg-green-900/30`
- Danger: `text-red-400`, `bg-red-900/30`

### Component Classes
- Buttons: `.btn`, `.btn-primary`, `.btn-secondary`, `.btn-danger`
- Inputs: `.input`
- Cards: `.card`
- Badges: `.badge`
- Tables: `.table`, `.th`, `.td`

## Security

1. **Authentication**: Only super admins (enforced by `requireSuperAdmin` middleware)
2. **Authorization**: Hub backend acts as proxy, validates permissions
3. **Network**: Kong Admin API stays on internal Docker network
4. **Input Validation**: Validate all inputs before sending to Kong
5. **Error Handling**: Don't expose Kong internal errors to frontend

## Environment Variables

```bash
# Kong Admin API URL (internal Docker network)
KONG_ADMIN_URL=http://kong:8001
```
