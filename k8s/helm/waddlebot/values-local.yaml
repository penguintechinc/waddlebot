# WaddleBot Helm Chart - Local/MicroK8s Overrides
# This file contains overrides for local development and MicroK8s deployments

# Global settings for local development
global:
  imageRegistry: "localhost:32000/waddlebot"
  imagePullPolicy: Always
  storageClass: "microk8s-hostpath"
  jwtSecret: "local-dev-jwt-secret-change-in-production"
  moduleSecretKey: "local-dev-module-secret-change-in-production"
  serviceApiKey: "local-dev-api-key-change-in-production"

# Top-level infrastructure for template compatibility
redis:
  enabled: false
  replicas: 1
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  maxMemory: "256mb"
  maxMemoryPolicy: "allkeys-lru"
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

postgresql:
  enabled: false
  replicas: 1

postgres:
  enabled: false
  replicas: 1

minio:
  enabled: false
  replicas: 1

ollama:
  enabled: false
  replicas: 1

qdrant:
  enabled: false
  replicas: 1

# Namespace configuration
namespace:
  create: true
  name: waddlebot

# Service port configuration for ingress
hub:
  service:
    port: 8060

router:
  service:
    port: 8000

identityCore:
  service:
    port: 8050

labelsCore:
  service:
    port: 8023

browserSource:
  service:
    port: 8027

reputation:
  service:
    port: 8021

community:
  service:
    port: 8020

twitchCollector:
  service:
    port: 8002

discordCollector:
  service:
    port: 8003

slackCollector:
  service:
    port: 8004

# Infrastructure Services - Local Configuration (disabled for now due to chart issues)
infrastructure:
  # PostgreSQL - Single instance for local
  postgresql:
    enabled: false
    replicas: 1

  # Redis - Single instance for local
  redis:
    enabled: false
    replicas: 1

  # MinIO - Single instance for local
  minio:
    enabled: false
    replicas: 1

  # Ollama - With GPU support if available
  ollama:
    enabled: false
    replicas: 1

  # Qdrant - Single instance for local
  qdrant:
    enabled: false
    replicas: 1

  # OpenWhisk - Disabled for local
  openwhisk:
    enabled: false

# Processing Module - Local Configuration
processing:
  router:
    enabled: true
    replicas: 1
    resourcePreset: medium
    autoscaling:
      enabled: false

# Admin Modules - Local Configuration
admin:
  hub:
    enabled: true
    replicas: 1
    resourcePreset: medium

# Core Modules - Local Configuration
core:
  identity:
    enabled: true
    replicas: 1
    resourcePreset: small

  labels:
    enabled: true
    replicas: 1
    resourcePreset: small

  browserSource:
    enabled: true
    replicas: 1
    resourcePreset: small

  reputation:
    enabled: true
    replicas: 1
    resourcePreset: small

  community:
    enabled: true
    replicas: 1
    resourcePreset: small

  aiResearcher:
    enabled: true
    replicas: 1
    resourcePreset: medium

# Trigger Modules - Local Configuration
trigger:
  receivers:
    twitch:
      enabled: true
      replicas: 1
      resourcePreset: medium

    discord:
      enabled: true
      replicas: 1
      resourcePreset: small

    slack:
      enabled: true
      replicas: 1
      resourcePreset: small

    youtubeLive:
      enabled: true
      replicas: 1
      resourcePreset: small

    kick:
      enabled: true
      replicas: 1
      resourcePreset: small

# Action Modules - Local Configuration
action:
  interactive:
    ai:
      enabled: true
      replicas: 1
      resourcePreset: medium

    alias:
      enabled: true
      replicas: 1
      resourcePreset: small

    shoutout:
      enabled: true
      replicas: 1
      resourcePreset: small

    inventory:
      enabled: true
      replicas: 1
      resourcePreset: small

    calendar:
      enabled: true
      replicas: 1
      resourcePreset: small

    memories:
      enabled: true
      replicas: 1
      resourcePreset: small

    youtubeMusic:
      enabled: true
      replicas: 1
      resourcePreset: small

    spotify:
      enabled: true
      replicas: 1
      resourcePreset: small

    loyalty:
      enabled: true
      replicas: 1
      resourcePreset: small

  platformActions:
    discord:
      enabled: true
      replicas: 1
      resourcePreset: small

    slack:
      enabled: true
      replicas: 1
      resourcePreset: small

    twitch:
      enabled: true
      replicas: 1
      resourcePreset: small

    youtube:
      enabled: true
      replicas: 1
      resourcePreset: small

# Ingress Configuration - Local/MicroK8s
ingress:
  enabled: true
  className: "public"  # MicroK8s default ingress class
  annotations:
    # Remove cert-manager for local
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
  hosts:
    - host: waddlebot.local
      paths:
        - path: /
          pathType: Prefix
          service: hub
          port: 8060
        - path: /api/router
          pathType: Prefix
          service: router
          port: 8000
        - path: /api/identity
          pathType: Prefix
          service: identity-core
          port: 8050
        - path: /api/labels
          pathType: Prefix
          service: labels-core
          port: 8023
        - path: /api/browser-source
          pathType: Prefix
          service: browser-source
          port: 8027
        - path: /api/reputation
          pathType: Prefix
          service: reputation
          port: 8021
        - path: /api/community
          pathType: Prefix
          service: community
          port: 8020
        - path: /webhooks/twitch
          pathType: Prefix
          service: twitch-collector
          port: 8002
        - path: /webhooks/discord
          pathType: Prefix
          service: discord-collector
          port: 8003
        - path: /webhooks/slack
          pathType: Prefix
          service: slack-collector
          port: 8004
  tls: []  # No TLS for local development

# Database credentials for secrets
postgres:
  password: "postgres"

redis:
  password: "redis-password"

# MinIO credentials
minio:
  rootUser: "minioadmin"
  rootPassword: "minioadmin"

# AWS credentials (for Lambda)
aws:
  accessKeyId: ""
  secretAccessKey: ""
  region: "us-east-1"
  lambdaRoleArn: ""

# GCP credentials (for Cloud Functions)
gcp:
  projectId: ""
  serviceAccount: ""

# OpenWhisk credentials (for OpenWhisk functions)
openwhisk:
  apiHost: ""
  authKey: ""
  namespace: ""
  insecure: "true"

# WaddleAI Integration
waddleai:
  baseUrl: ""
  apiKey: ""

# OAuth Configuration - Placeholders for local development
oauth:
  discord:
    clientId: ""
    clientSecret: ""
    botToken: ""
    applicationId: ""
  twitch:
    clientId: ""
    clientSecret: ""
    webhookSecret: ""
  slack:
    clientId: ""
    clientSecret: ""
    botToken: ""
    signingSecret: ""
  youtube:
    apiKey: ""
    clientId: ""
    clientSecret: ""
    webhookCallbackUrl: ""
  spotify:
    clientId: ""
    clientSecret: ""
  kick:
    clientId: ""
    clientSecret: ""
    webhookSecret: ""

# Shared Environment Variables - Local Overrides
sharedEnv:
  # Database Configuration
  DB_HOST: "postgresql"
  DB_PORT: "5432"
  DB_NAME: "waddlebot"
  DB_USER: "waddlebot"
  DB_POOL_SIZE: "10"
  DB_MAX_OVERFLOW: "5"

  # Redis Configuration
  REDIS_HOST: "redis"
  REDIS_PORT: "6379"
  REDIS_DB: "0"

  # MinIO Configuration
  MINIO_ENDPOINT: "minio:9000"
  MINIO_SECURE: "false"

  # Ollama Configuration
  OLLAMA_HOST: "http://ollama:11434"
  OLLAMA_MODEL: "llama3.1"

  # Qdrant Configuration
  QDRANT_HOST: "qdrant"
  QDRANT_PORT: "6333"
  QDRANT_GRPC_PORT: "6334"

  # Router Configuration
  ROUTER_URL: "http://router:8000"

  # Hub Configuration
  HUB_URL: "http://hub:8060"

  # Logging Configuration
  LOG_LEVEL: "DEBUG"
  LOG_FORMAT: "json"
  LOG_FILE_ENABLED: "true"
  LOG_FILE_PATH: "/var/log/waddlebotlog"
  LOG_FILE_MAX_BYTES: "5242880"
  LOG_FILE_BACKUP_COUNT: "3"

  # License Server
  LICENSE_SERVER_URL: "https://license.penguintech.io"
  RELEASE_MODE: "false"

  # Feature Flags
  ENABLE_METRICS: "false"
  ENABLE_TRACING: "false"
  ENABLE_PROFILING: "false"

  # Development mode
  DEBUG: "true"
  DEVELOPMENT_MODE: "true"

# Persistent Volume Claims - Smaller for local
persistence:
  logs:
    enabled: true
    size: 2Gi
    storageClass: "microk8s-hostpath"
    accessMode: ReadWriteMany

# Resource presets - Reduced for local development
resourcePresets:
  small:
    cpu: "50m"
    memory: "64Mi"
    cpuLimit: "200m"
    memoryLimit: "256Mi"
  medium:
    cpu: "100m"
    memory: "128Mi"
    cpuLimit: "500m"
    memoryLimit: "512Mi"
  large:
    cpu: "200m"
    memory: "256Mi"
    cpuLimit: "1000m"
    memoryLimit: "1Gi"

# Monitoring - Disabled for local
monitoring:
  prometheus:
    enabled: false
  grafana:
    enabled: false

# Network Policies - Disabled for local
networkPolicy:
  enabled: false

# Pod Security Context - Relaxed for local
podSecurityContext:
  runAsNonRoot: false
  fsGroup: 1000

# Container Security Context - Relaxed for local
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  runAsNonRoot: false
  capabilities:
    drop:
      - ALL

# Modules - Map action structure to modules structure for template compatibility
modules:
  # Default service configuration for all modules
  _defaults: &module_defaults
    replicas: 1
    imageTag: latest
    resources: {}
    service:
      type: ClusterIP
    image:
      tag: latest
      pullPolicy: IfNotPresent

  router:
    <<: *module_defaults
    enabled: true

  # Core modules
  identityCore:
    <<: *module_defaults
    enabled: true

  labelsCore:
    <<: *module_defaults
    enabled: true

  browserSource:
    <<: *module_defaults
    enabled: true

  reputation:
    <<: *module_defaults
    enabled: true

  community:
    <<: *module_defaults
    enabled: true

  aiResearcher:
    <<: *module_defaults
    enabled: false

  # Trigger modules (collectors) - nested under collectors
  collectors:
    twitch:
      <<: *module_defaults
      enabled: true

    discord:
      <<: *module_defaults
      enabled: true

    slack:
      <<: *module_defaults
      enabled: true

    youtubeLive:
      <<: *module_defaults
      enabled: true

    kick:
      <<: *module_defaults
      enabled: true

  # Admin modules
  hub:
    <<: *module_defaults
    enabled: true

  interactive:
    ai:
      <<: *module_defaults
      enabled: true
    alias:
      <<: *module_defaults
      enabled: true
    shoutout:
      <<: *module_defaults
      enabled: true
    inventory:
      <<: *module_defaults
      enabled: true
    calendar:
      <<: *module_defaults
      enabled: true
    memories:
      <<: *module_defaults
      enabled: true
    youtubeMusic:
      <<: *module_defaults
      enabled: true
    spotify:
      <<: *module_defaults
      enabled: true
    loyalty:
      <<: *module_defaults
      enabled: true

  pushing:
    discordAction:
      <<: *module_defaults
      enabled: false
    slackAction:
      <<: *module_defaults
      enabled: false
    twitchAction:
      <<: *module_defaults
      enabled: false
    youtubeAction:
      <<: *module_defaults
      enabled: false
