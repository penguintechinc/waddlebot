{% extends "layout.html" %}

{% block title %}
{% if community %}{{ community.name }} Hub{% else %}WaddleBot Community Hub{% endif %}
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero is-primary is-medium">
    <div class="hero-body">
        <div class="container has-text-centered">
            {% if community %}
            <h1 class="title is-1">{{ community.name }}</h1>
            <h2 class="subtitle">Community Hub</h2>
            {% else %}
            <h1 class="title is-1">WaddleBot Community Hub</h1>
            <h2 class="subtitle">The epicenter for communities across platforms</h2>
            {% endif %}

            <!-- Platform Stats -->
            <div class="columns is-centered mt-5">
                <div class="column is-narrow">
                    <div class="box platform-stat discord-bg">
                        <span class="icon is-large"><i class="fab fa-discord fa-2x"></i></span>
                        <p class="title is-4">{{ platform_stats.discord.servers }}</p>
                        <p class="subtitle is-6">Discord Servers</p>
                    </div>
                </div>
                <div class="column is-narrow">
                    <div class="box platform-stat twitch-bg">
                        <span class="icon is-large"><i class="fab fa-twitch fa-2x"></i></span>
                        <p class="title is-4">{{ platform_stats.twitch.channels }}</p>
                        <p class="subtitle is-6">Twitch Channels</p>
                        {% if platform_stats.twitch.live > 0 %}
                        <span class="tag is-danger is-light">{{ platform_stats.twitch.live }} Live</span>
                        {% endif %}
                    </div>
                </div>
                <div class="column is-narrow">
                    <div class="box platform-stat slack-bg">
                        <span class="icon is-large"><i class="fab fa-slack fa-2x"></i></span>
                        <p class="title is-4">{{ platform_stats.slack.workspaces }}</p>
                        <p class="subtitle is-6">Slack Workspaces</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Live Streams Section -->
{% if live_streams %}
<section class="section">
    <div class="container">
        <h2 class="title is-3">
            <span class="live-indicator"></span> Live Now
        </h2>
        <div class="columns is-multiline" id="live-streams-container">
            {% for stream in live_streams %}
            <div class="column is-4">
                <div class="card stream-card">
                    {% if stream.thumbnail_url %}
                    <div class="card-image">
                        <figure class="image is-16by9">
                            <img src="{{ stream.thumbnail_url }}" alt="{{ stream.channel_name }}">
                        </figure>
                        <span class="viewer-count tag is-dark">
                            <i class="fas fa-eye mr-1"></i>{{ stream.viewer_count | format_number }}
                        </span>
                    </div>
                    {% endif %}
                    <div class="card-content">
                        <div class="media">
                            <div class="media-content">
                                <p class="title is-5">{{ stream.channel_name }}</p>
                                <p class="subtitle is-6 has-text-grey">
                                    {{ stream.title | truncate(50) if stream.title else 'Streaming' }}
                                </p>
                                {% if stream.game %}
                                <span class="tag is-info is-light">{{ stream.game }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="has-text-centered mt-4">
            <a class="button is-link is-outlined" href="{{ url_for('public.live_streams') }}">
                View All Live Streams
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Communities Section (only on global hub) -->
{% if not community and communities %}
<section class="section has-background-light">
    <div class="container">
        <h2 class="title is-3">Featured Communities</h2>
        <div class="columns is-multiline">
            {% for comm in communities %}
            <div class="column is-4">
                <div class="card">
                    <div class="card-content">
                        <p class="title is-5">{{ comm.name }}</p>
                        <p class="subtitle is-6 has-text-grey">
                            {{ comm.description | truncate(100) if comm.description else 'A WaddleBot community' }}
                        </p>
                        <div class="level is-mobile">
                            <div class="level-left">
                                <span class="tag is-light">
                                    <i class="fas fa-users mr-1"></i>{{ comm.member_count }} members
                                </span>
                            </div>
                            <div class="level-right">
                                <a class="button is-small is-primary" href="{{ url_for('public.community_view', community_id=comm.id) }}">
                                    View
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="has-text-centered mt-4">
            <a class="button is-link is-outlined" href="{{ url_for('public.community_list') }}">
                Browse All Communities
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- CTA Section -->
<section class="section">
    <div class="container">
        <div class="box has-text-centered">
            <h3 class="title is-4">Ready to dive deeper?</h3>
            <p class="subtitle">Login with Discord, Twitch, or Slack to see member lists, activity feeds, and more.</p>
            {% if not session.get('user') %}
            <a class="button is-primary is-medium" href="{{ url_for('auth.login') }}">
                <i class="fas fa-sign-in-alt mr-2"></i> Login to Explore
            </a>
            {% else %}
            <a class="button is-primary is-medium" href="{{ url_for('authenticated.dashboard') }}">
                <i class="fas fa-tachometer-alt mr-2"></i> Go to Dashboard
            </a>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/live-updates.js') }}"></script>
<script>
    // Initialize live stream polling
    if (typeof initLiveUpdates === 'function') {
        initLiveUpdates(30000); // 30 second polling
    }
</script>
{% endblock %}
