{% extends "layout.html" %}

{% block title %}Live Streams - WaddleBot{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 class="title">
            <span class="live-indicator"></span> Live Streams
        </h1>
        <p class="subtitle">
            {% if community %}
            Streams from {{ community.name }}
            {% else %}
            All WaddleBot community streams
            {% endif %}
        </p>

        {% if live_streams %}
        <div class="columns is-multiline" id="live-streams-container">
            {% for stream in live_streams %}
            <div class="column is-4">
                <div class="card stream-card">
                    {% if stream.thumbnail_url %}
                    <div class="card-image">
                        <figure class="image is-16by9">
                            <img src="{{ stream.thumbnail_url }}" alt="{{ stream.channel_name }}">
                        </figure>
                        <span class="viewer-count tag is-dark">
                            <i class="fas fa-eye mr-1"></i>{{ stream.viewer_count }}
                        </span>
                    </div>
                    {% endif %}
                    <div class="card-content">
                        <div class="media">
                            <div class="media-content">
                                <p class="title is-5">{{ stream.channel_name }}</p>
                                <p class="subtitle is-6 has-text-grey">
                                    {{ stream.title | truncate(80) if stream.title else 'Streaming' }}
                                </p>
                            </div>
                        </div>
                        <div class="content">
                            {% if stream.game %}
                            <span class="tag is-info is-light">{{ stream.game }}</span>
                            {% endif %}
                            {% if stream.live_since %}
                            <span class="tag is-light">
                                <i class="fas fa-clock mr-1"></i>
                                Live for {{ stream.live_since | time_since }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <footer class="card-footer">
                        <a href="https://twitch.tv/{{ stream.channel_name }}"
                           target="_blank"
                           class="card-footer-item twitch-link">
                            <i class="fab fa-twitch mr-2"></i> Watch on Twitch
                        </a>
                    </footer>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="box has-text-centered">
            <p class="has-text-grey">
                <i class="fas fa-broadcast-tower fa-3x mb-4"></i><br>
                No streams are currently live.
            </p>
        </div>
        {% endif %}

        <!-- Recently Live -->
        {% if recently_live %}
        <hr>
        <h2 class="title is-4 mt-6">Recently Live</h2>
        <p class="subtitle is-6 has-text-grey">Streams that ended in the last 24 hours</p>

        <div class="columns is-multiline">
            {% for stream in recently_live %}
            <div class="column is-3">
                <div class="box">
                    <p class="title is-6">{{ stream.channel_name }}</p>
                    {% if stream.game %}
                    <span class="tag is-light is-small">{{ stream.game }}</span>
                    {% endif %}
                    <p class="is-size-7 has-text-grey mt-2">
                        Last live: {{ stream.last_live | time_since }}
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/live-updates.js') }}"></script>
<script>
    if (typeof initLiveUpdates === 'function') {
        initLiveUpdates(30000);
    }
</script>
{% endblock %}
