{% extends "layout.html" %}

{% block title %}Members - {{ community.name }} - WaddleBot{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
                <li><a href="{{ url_for('authenticated.dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('authenticated.community_hub', community_id=community.id) }}">{{ community.name }}</a></li>
                <li class="is-active"><a href="#">Members</a></li>
            </ul>
        </nav>

        <h1 class="title">Members</h1>
        <p class="subtitle">{{ total }} members in {{ community.name }}</p>

        {% if members %}
        <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>User</th>
                        <th>Role</th>
                        <th>Reputation</th>
                        <th>Joined</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr>
                        <td>{{ (page - 1) * per_page + loop.index }}</td>
                        <td>{{ member.user_id }}</td>
                        <td>
                            <span class="tag {% if member.role == 'owner' %}is-danger{% elif member.role == 'moderator' %}is-warning{% else %}is-light{% endif %}">
                                {{ member.role | title }}
                            </span>
                        </td>
                        <td>
                            <strong>{{ member.reputation_score | format_number }}</strong> pts
                        </td>
                        <td>{{ member.joined_at | time_since if member.joined_at else 'Unknown' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <nav class="pagination is-centered mt-5" role="navigation" aria-label="pagination">
            {% if page > 1 %}
            <a class="pagination-previous"
               href="{{ url_for('authenticated.members', community_id=community.id, page=page-1) }}">
                Previous
            </a>
            {% else %}
            <a class="pagination-previous" disabled>Previous</a>
            {% endif %}

            {% if page < total_pages %}
            <a class="pagination-next"
               href="{{ url_for('authenticated.members', community_id=community.id, page=page+1) }}">
                Next
            </a>
            {% else %}
            <a class="pagination-next" disabled>Next</a>
            {% endif %}

            <ul class="pagination-list">
                {% for p in range(1, total_pages + 1) %}
                <li>
                    <a class="pagination-link {% if p == page %}is-current{% endif %}"
                       href="{{ url_for('authenticated.members', community_id=community.id, page=p) }}">
                        {{ p }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </nav>
        {% endif %}
        {% else %}
        <div class="box has-text-centered">
            <p class="has-text-grey">No members found.</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
