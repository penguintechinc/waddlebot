version: '3.8'

services:
  slack-action:
    build: .
    container_name: slack-action-module
    ports:
      - "8071:8071"  # REST API
      - "50052:50052"  # gRPC
    environment:
      # Slack Configuration
      SLACK_BOT_TOKEN: ${SLACK_BOT_TOKEN}
      SLACK_APP_TOKEN: ${SLACK_APP_TOKEN:-}

      # Database Configuration
      DATABASE_URL: postgresql://waddlebot:waddlebot@postgres:5432/waddlebot

      # gRPC Configuration
      GRPC_PORT: 50052
      GRPC_MAX_WORKERS: 10

      # REST API Configuration
      REST_PORT: 8071

      # JWT Authentication
      MODULE_SECRET_KEY: ${MODULE_SECRET_KEY}

      # Performance Settings
      MAX_CONCURRENT_REQUESTS: 100
      REQUEST_TIMEOUT: 30

      # Logging
      LOG_LEVEL: INFO
      LOG_DIR: /var/log/waddlebotlog

    depends_on:
      - postgres
    restart: unless-stopped
    networks:
      - waddlebot

  postgres:
    image: postgres:15-alpine
    container_name: slack-action-postgres
    environment:
      POSTGRES_USER: waddlebot
      POSTGRES_PASSWORD: waddlebot
      POSTGRES_DB: waddlebot
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - waddlebot

volumes:
  postgres_data:

networks:
  waddlebot:
    driver: bridge
